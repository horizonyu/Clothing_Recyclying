# 管理后台访问问题排查指南

## 问题描述

无法通过 `http://42.194.134.223:3000/` 访问管理后台。

## 🔍 排查步骤

### 步骤 1：检查前端服务是否运行

**在服务器上执行：**

```bash
# 检查 Node.js 进程
ps aux | grep node | grep -v grep

# 或检查 3000 端口是否被占用
netstat -tlnp | grep 3000
# 或
ss -tlnp | grep 3000
```

**预期结果**：
- 如果看到 Node.js 进程和 3000 端口监听，说明服务已启动
- 如果没有，需要启动服务

**如果服务未启动，执行：**

```bash
cd /home/ubuntu/yzh/code/Clothing_Recyclying/admin
npm run dev
```

---

### 步骤 2：检查服务监听地址

**在服务器上执行：**

```bash
# 检查服务监听的地址
netstat -tlnp | grep 3000
```

**预期结果**：
- 应该看到 `0.0.0.0:3000` 或 `:::3000`（表示监听所有网络接口）
- 如果只看到 `127.0.0.1:3000`，说明只监听本地，需要修改配置

**如果只监听本地，检查配置文件：**

```bash
cd /home/ubuntu/yzh/code/Clothing_Recyclying/admin
cat vite.config.js | grep -A 5 "server:"
```

应该看到：
```javascript
server: {
  host: '0.0.0.0',  // 必须是这样
  port: 3000,
  ...
}
```

---

### 步骤 3：检查服务器防火墙（UFW）

**在服务器上执行：**

```bash
# 检查防火墙状态
sudo ufw status

# 如果防火墙是激活的，检查 3000 端口是否开放
sudo ufw status | grep 3000
```

**如果防火墙激活但 3000 端口未开放：**

```bash
# 开放 3000 端口
sudo ufw allow 3000/tcp

# 重新加载防火墙规则
sudo ufw reload

# 验证
sudo ufw status | grep 3000
```

---

### 步骤 4：检查云服务器安全组（重要！）

这是**最常见的问题**。云服务器（如阿里云、腾讯云）需要在控制台配置安全组规则。

#### 阿里云

1. 登录 [阿里云控制台](https://ecs.console.aliyun.com/)
2. 进入 **云服务器 ECS** → **实例**
3. 找到你的服务器，点击 **更多** → **网络和安全组** → **安全组配置**
4. 点击安全组 ID，进入安全组规则
5. 点击 **添加安全组规则**
6. 配置：
   - **规则方向**：入方向
   - **授权策略**：允许
   - **端口范围**：3000/3000
   - **授权对象**：0.0.0.0/0（允许所有IP访问）
   - **描述**：管理后台前端端口
7. 点击 **保存**

#### 腾讯云

1. 登录 [腾讯云控制台](https://console.cloud.tencent.com/)
2. 进入 **云服务器 CVM** → **实例**
3. 找到你的服务器，点击 **更多** → **安全组** → **配置安全组**
4. 点击安全组 ID，进入规则管理
5. 点击 **入站规则** → **添加规则**
6. 配置：
   - **类型**：自定义
   - **来源**：0.0.0.0/0
   - **协议端口**：TCP:3000
   - **策略**：允许
   - **备注**：管理后台前端端口
7. 点击 **完成**

#### 华为云

1. 登录 [华为云控制台](https://console.huaweicloud.com/)
2. 进入 **弹性云服务器 ECS** → **实例**
3. 找到你的服务器，点击 **安全组**
4. 点击安全组名称，进入规则
5. 点击 **添加规则**
6. 配置：
   - **方向**：入方向
   - **协议**：TCP
   - **端口**：3000
   - **源地址**：0.0.0.0/0
   - **描述**：管理后台前端端口
7. 点击 **确定**

---

### 步骤 5：在服务器本地测试

**在服务器上执行：**

```bash
# 测试本地访问
curl http://localhost:3000

# 或
curl http://127.0.0.1:3000
```

**预期结果**：
- 如果返回 HTML 内容，说明服务正常运行
- 如果连接被拒绝，说明服务未启动或配置错误

---

### 步骤 6：检查服务启动日志

**查看前端服务的启动日志：**

```bash
# 如果使用 npm run dev 启动，查看终端输出
# 应该看到类似：
# ➜  Local:   http://localhost:3000/
# ➜  Network: http://42.194.134.223:3000/
```

**如果没有 Network 地址，说明配置有问题。**

---

## 🛠️ 快速修复方案

### 方案 A：确保服务正在运行

```bash
# 1. 进入前端目录
cd /home/ubuntu/yzh/code/Clothing_Recyclying/admin

# 2. 检查是否有 node_modules
if [ ! -d "node_modules" ]; then
    npm install
fi

# 3. 启动服务（前台运行，方便查看日志）
npm run dev
```

**启动后应该看到：**
```
VITE v5.x.x  ready in xxx ms

➜  Local:   http://localhost:3000/
➜  Network: http://42.194.134.223:3000/  ← 这个很重要！
```

---

### 方案 B：使用 PM2 后台运行（推荐生产环境）

```bash
# 1. 安装 PM2
npm install -g pm2

# 2. 进入前端目录
cd /home/ubuntu/yzh/code/Clothing_Recyclying/admin

# 3. 使用 PM2 启动
pm2 start npm --name "admin-frontend" -- run dev

# 4. 查看状态
pm2 status

# 5. 查看日志
pm2 logs admin-frontend

# 6. 设置开机自启
pm2 startup
pm2 save
```

---

### 方案 C：检查并修复配置

**确保 `vite.config.js` 配置正确：**

```bash
cd /home/ubuntu/yzh/code/Clothing_Recyclying/admin
cat vite.config.js
```

应该包含：
```javascript
server: {
  host: '0.0.0.0',  // 必须设置，允许外部访问
  port: 3000,
  proxy: {
    '/api': {
      target: 'http://localhost:8000',
      changeOrigin: true
    }
  }
}
```

如果 `host` 不是 `'0.0.0.0'`，修改后重启服务。

---

## 📋 完整排查清单

在服务器上依次执行以下命令，记录结果：

```bash
# 1. 检查服务是否运行
echo "=== 1. 检查服务进程 ==="
ps aux | grep node | grep -v grep

# 2. 检查端口监听
echo "=== 2. 检查端口监听 ==="
netstat -tlnp | grep 3000

# 3. 检查防火墙
echo "=== 3. 检查防火墙 ==="
sudo ufw status

# 4. 测试本地访问
echo "=== 4. 测试本地访问 ==="
curl -I http://localhost:3000 2>&1 | head -5

# 5. 检查配置文件
echo "=== 5. 检查配置 ==="
cd /home/ubuntu/yzh/code/Clothing_Recyclying/admin
grep -A 3 "host:" vite.config.js

# 6. 检查 Node.js 版本
echo "=== 6. Node.js 版本 ==="
node -v
npm -v
```

---

## 🎯 常见问题

### Q1: 服务启动后只显示 Local 地址，没有 Network 地址

**原因**：`vite.config.js` 中 `host` 配置不正确

**解决**：
```bash
cd /home/ubuntu/yzh/code/Clothing_Recyclying/admin
# 编辑 vite.config.js，确保 host: '0.0.0.0'
# 然后重启服务
```

---

### Q2: 本地可以访问，但外部无法访问

**原因**：云服务器安全组未开放 3000 端口

**解决**：按照上面的"步骤 4"配置安全组规则

---

### Q3: 连接超时

**可能原因**：
1. 服务未启动
2. 防火墙阻止
3. 安全组未配置
4. 服务崩溃

**排查**：
```bash
# 检查服务状态
ps aux | grep node

# 检查端口
netstat -tlnp | grep 3000

# 查看日志（如果使用 PM2）
pm2 logs admin-frontend
```

---

### Q4: 访问时显示 "无法访问此网站"

**可能原因**：
1. 服务未启动
2. 端口被其他程序占用
3. 防火墙阻止

**排查**：
```bash
# 检查端口占用
sudo lsof -i :3000

# 如果被占用，可以：
# 1. 停止占用端口的程序
# 2. 或修改 vite.config.js 中的 port 为其他端口（如 3001）
```

---

## ✅ 验证步骤

修复后，按以下步骤验证：

1. **在服务器上测试**：
   ```bash
   curl http://localhost:3000
   ```

2. **在本地电脑测试**：
   ```bash
   curl http://42.194.134.223:3000
   ```

3. **在浏览器访问**：
   ```
   http://42.194.134.223:3000
   ```

如果都能正常访问，说明问题已解决！

---

## 📞 如果问题仍未解决

请提供以下信息：

1. **服务状态**：
   ```bash
   ps aux | grep node
   netstat -tlnp | grep 3000
   ```

2. **防火墙状态**：
   ```bash
   sudo ufw status
   ```

3. **启动日志**：
   ```bash
   # 如果使用 PM2
   pm2 logs admin-frontend --lines 50
   
   # 如果直接运行 npm run dev，提供终端输出
   ```

4. **配置文件内容**：
   ```bash
   cat /home/ubuntu/yzh/code/Clothing_Recyclying/admin/vite.config.js
   ```

5. **云服务器类型**：阿里云/腾讯云/华为云/其他

---

**最后更新**：2026-02-07  
**适用服务器**：42.194.134.223
