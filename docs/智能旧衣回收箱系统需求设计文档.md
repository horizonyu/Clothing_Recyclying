# 智能旧衣回收箱系统需求设计文档

**版本：** V1.0  
**创建日期：** 2026年1月2日  
**文档状态：** 初稿

---

## 目录

1. [项目概述](#1-项目概述)
2. [市场调研与分析](#2-市场调研与分析)
3. [系统架构设计](#3-系统架构设计)
4. [硬件功能需求](#4-硬件功能需求)
5. [软件功能需求](#5-软件功能需求)
6. [接口设计](#6-接口设计)
7. [数据库设计](#7-数据库设计)
8. [业务流程设计](#8-业务流程设计)
9. [安全设计](#9-安全设计)
10. [非功能性需求](#10-非功能性需求)
11. [项目里程碑](#11-项目里程碑)

---

## 1. 项目概述

### 1.1 项目背景

随着环保意识的增强和可持续发展理念的普及，旧衣物回收成为资源循环利用的重要环节。传统的旧衣物回收方式存在以下痛点：

- 回收方式单一，用户体验差
- 缺乏透明的称重和计价机制
- 难以追踪衣物流向，用户信任度低
- 运营方无法实时监控回收箱状态
- 存在安全隐患（如火灾、盗窃等）

智能旧衣回收箱系统旨在通过物联网技术、AI识别、移动互联网等现代技术手段，打造一个智能化、透明化、安全化的旧衣物回收解决方案。

### 1.2 项目目标

| 目标类别 | 具体目标 |
|---------|---------|
| 用户体验 | 提供便捷、透明、可追溯的回收体验 |
| 运营效率 | 实现远程监控、智能调度、自动预警 |
| 安全保障 | 24小时监控、多重报警机制 |
| 数据价值 | 积累回收数据，优化运营决策 |
| 环保贡献 | 量化碳减排贡献，提升用户参与感 |

### 1.3 项目范围

本项目包含以下三个主要模块：

```
┌─────────────────────────────────────────────────────────────┐
│                   智能旧衣回收箱系统                          │
├─────────────────┬─────────────────┬─────────────────────────┤
│   硬件终端系统    │   客户端小程序    │     后台管理系统         │
├─────────────────┼─────────────────┼─────────────────────────┤
│ • 智能回收箱      │ • 用户端小程序    │ • 运营管理后台           │
│ • 传感器模组      │ • 商户端小程序    │ • 数据分析平台           │
│ • 通信模块        │                 │ • 监控中心              │
└─────────────────┴─────────────────┴─────────────────────────┘
```

---

## 2. 市场调研与分析

### 2.1 市场现状

根据调研，目前市面上主流的智能旧衣回收箱产品包括：

| 品牌/平台 | 主要特点 | 定价模式 |
|----------|---------|---------|
| 支付宝×鸥燕回收 | AI估重系统、支付宝扫码、减碳量展示、公益捐赠 | 0.2元/公斤 |
| 琶洲街AI智能回收箱 | 社区部署、政企合作、垃圾分类联动 | 0.2元/公斤 |
| "我来收"智能回收箱 | 预约上门+自助投递、环保再生处理 | 按品类计价 |
| "榕益收"回收箱 | 内置锂电池无需接电、高校部署 | 现金奖励 |

### 2.2 竞品功能对比

| 功能模块 | 鸥燕回收 | 我来收 | 榕益收 | 本系统(规划) |
|---------|---------|-------|-------|-------------|
| AI估重 | ✓ | ✓ | ✓ | ✓ |
| 摄像监控 | ✓ | ○ | ○ | ✓ |
| 烟雾报警 | ○ | ○ | ○ | ✓ |
| AI衣物识别 | ○ | ○ | ○ | ✓ |
| 满载检测 | ✓ | ✓ | ✓ | ✓ |
| 即时提现 | ✓ | ✓ | ✓ | ✓ |
| 碳积分系统 | ✓ | ○ | ○ | ✓ |
| 公益捐赠 | ✓ | ○ | ○ | ✓ |
| 衣物溯源 | ○ | ✓ | ○ | ✓ |

> ✓ 支持 | ○ 不支持/未知

### 2.3 差异化优势

本系统计划实现的差异化功能：

1. **AI衣物识别验证** - 自动识别投递物品是否为合规衣物，过滤非衣物垃圾
2. **多重安全保障** - 烟雾报警 + 异常开门报警 + 视频监控三重保护
3. **衣物溯源追踪** - 用户可追踪自己投递衣物的处理去向
4. **碳积分体系** - 除现金奖励外，额外积累碳积分，可兑换公益或商品
5. **智能调度系统** - 基于满载预测的智能清运调度

---

## 3. 系统架构设计

### 3.1 整体架构

```
┌────────────────────────────────────────────────────────────────────┐
│                           用户层                                    │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────────┐  │
│  │  用户小程序   │  │  商户小程序   │  │    运营管理Web后台        │  │
│  └──────────────┘  └──────────────┘  └──────────────────────────┘  │
└────────────────────────────────────────────────────────────────────┘
                              │ HTTPS/WSS
                              ▼
┌────────────────────────────────────────────────────────────────────┐
│                          服务网关层                                 │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │    API Gateway (认证/限流/路由/日志)                          │  │
│  └──────────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌────────────────────────────────────────────────────────────────────┐
│                          业务服务层                                 │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────────┐  │
│  │  用户服务   │ │  订单服务   │ │  设备服务   │ │   支付服务      │  │
│  └────────────┘ └────────────┘ └────────────┘ └────────────────┘  │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────────┐  │
│  │ AI识别服务  │ │  通知服务   │ │  统计服务   │ │  积分服务       │  │
│  └────────────┘ └────────────┘ └────────────┘ └────────────────┘  │
└────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌────────────────────────────────────────────────────────────────────┐
│                          数据存储层                                 │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────────┐  │
│  │   MySQL    │ │   Redis    │ │  MongoDB   │ │   对象存储OSS   │  │
│  │  (业务数据) │ │  (缓存)    │ │  (日志)    │ │  (图片/视频)    │  │
│  └────────────┘ └────────────┘ └────────────┘ └────────────────┘  │
└────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌────────────────────────────────────────────────────────────────────┐
│                         物联网接入层                                │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │           IoT Platform (MQTT Broker / CoAP)                   │  │
│  └──────────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────────┘
                              │ MQTT/4G/WiFi
                              ▼
┌────────────────────────────────────────────────────────────────────┐
│                          硬件设备层                                 │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │                    智能旧衣回收箱 × N                          │  │
│  │  [摄像头] [称重传感器] [烟雾传感器] [门禁] [显示屏] [4G模块]     │  │
│  └──────────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────────┘
```

### 3.2 技术选型

| 层级 | 技术选型 | 说明 |
|-----|---------|------|
| 用户小程序 | 微信小程序/支付宝小程序 | 主流用户触达渠道 |
| 后台前端 | Vue3 + Element Plus | 管理后台界面 |
| 服务网关 | Nginx + Kong | API网关、负载均衡 |
| 后端服务 | Python FastAPI / Go Gin | 微服务架构 |
| 数据库 | MySQL 8.0 + Redis 7.0 | 业务数据 + 缓存 |
| 消息队列 | RabbitMQ / Kafka | 异步消息处理 |
| IoT平台 | EMQX | MQTT消息代理 |
| AI服务 | TensorFlow / PyTorch | 图像识别模型 |
| 云平台 | 阿里云/腾讯云 | 基础设施 |

### 3.3 硬件架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        智能回收箱硬件架构                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                    主控单元 (MCU/ARM)                      │   │
│  │                   Linux/RTOS 嵌入式系统                    │   │
│  └──────────────────────────────────────────────────────────┘   │
│         │          │          │          │          │           │
│         ▼          ▼          ▼          ▼          ▼           │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌────────┐ │
│  │ 摄像头模组 │ │ 称重模组  │ │ 传感器组  │ │ 显示模组  │ │通信模组 │ │
│  │          │ │          │ │          │ │          │ │        │ │
│  │• 高清摄像 │ │• 压力传感 │ │• 烟雾检测 │ │• LCD屏幕 │ │• 4G/5G │ │
│  │• 夜视功能 │ │• HX711   │ │• 温度检测 │ │• 二维码  │ │• WiFi  │ │
│  │• AI边缘  │ │• 高精度   │ │• 门磁感应 │ │• 触摸屏  │ │• GPS   │ │
│  │  计算    │ │  称重     │ │• 满载检测 │ │• LED指示 │ │• BLE   │ │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └────────┘ │
│         │          │          │          │          │           │
│         └──────────┴──────────┴──────────┴──────────┘           │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                      电源管理单元                          │   │
│  │           AC 220V → DC 12V/5V + UPS备用电源               │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. 硬件功能需求

### 4.1 功能模块清单

| 模块ID | 模块名称 | 优先级 | 描述 |
|-------|---------|-------|------|
| HW-001 | 称重系统 | P0 | 精确测量投递衣物重量 |
| HW-002 | 摄像监控 | P0 | 实时视频监控与录像 |
| HW-003 | 烟雾报警 | P0 | 检测火灾隐患并报警 |
| HW-004 | 显示交互 | P0 | 二维码显示与操作提示 |
| HW-005 | 通信模块 | P0 | 4G/WiFi数据上报 |
| HW-006 | 满载检测 | P1 | 检测箱体容量状态 |
| HW-007 | 门禁控制 | P1 | 电磁锁控制与检测 |
| HW-008 | 温度检测 | P2 | 箱内温度监测 |
| HW-009 | GPS定位 | P2 | 设备位置追踪 |
| HW-010 | AI边缘计算 | P2 | 本地图像预处理 |

### 4.2 详细功能需求

#### 4.2.1 称重系统 (HW-001)

**功能描述：** 准确测量用户投递衣物的重量，作为金额计算的依据。

**技术指标：**
| 参数 | 指标值 |
|-----|-------|
| 量程 | 0 - 50 kg |
| 精度 | ±10g |
| 分辨率 | 5g |
| 响应时间 | < 2秒 |
| 去皮功能 | 支持 |
| 工作温度 | -10°C ~ 50°C |

**业务规则：**
- 单次投递最小重量：100g（低于此重量不计费）
- 单次投递最大重量：20kg（超过需提示用户分批投递）
- 称重完成后锁定3秒，防止抖动误差

#### 4.2.2 摄像监控 (HW-002)

**功能描述：** 24小时实时监控回收箱周围环境和投递过程。

**技术指标：**
| 参数 | 指标值 |
|-----|-------|
| 分辨率 | 1080P (1920×1080) |
| 帧率 | 25fps |
| 夜视距离 | ≥ 5米 |
| 视角 | 120° 广角 |
| 存储 | 本地循环录像 + 云端关键帧 |
| 触发录像 | 运动检测、开门事件 |

**业务规则：**
- 正常状态：每5分钟上传一张缩略图
- 投递触发：录制投递过程视频（开门前5秒 ~ 关门后5秒）
- 异常触发：持续录像并实时推送
- 本地存储：支持7天循环覆盖

#### 4.2.3 烟雾报警 (HW-003)

**功能描述：** 检测箱内烟雾浓度，及时发现火灾隐患。

**技术指标：**
| 参数 | 指标值 |
|-----|-------|
| 检测灵敏度 | 烟雾浓度 > 0.15 dB/m 触发 |
| 响应时间 | < 10秒 |
| 报警方式 | 本地蜂鸣 + 远程推送 + 短信通知 |
| 误报率 | < 0.1% |
| 自检周期 | 每24小时自检一次 |

**业务规则：**
- 一级预警：烟雾浓度 0.15-0.3 dB/m，本地提示 + 后台预警
- 二级报警：烟雾浓度 > 0.3 dB/m，本地声光报警 + 紧急通知运维
- 报警后自动锁定投递口，防止助燃

#### 4.2.4 显示交互模块 (HW-004)

**功能描述：** 提供用户操作界面和信息展示。

**技术指标：**
| 参数 | 指标值 |
|-----|-------|
| 屏幕尺寸 | 10.1英寸 |
| 分辨率 | 1280×800 |
| 触摸方式 | 电容式多点触控 |
| 亮度 | ≥ 400nit（户外可见） |
| 工作温度 | -20°C ~ 60°C |

**界面内容：**
```
┌─────────────────────────────────────────┐
│            智能旧衣回收箱                 │
├─────────────────────────────────────────┤
│                                         │
│         ┌───────────────┐               │
│         │               │               │
│         │   二维码区域   │   扫码投递      │
│         │               │   或           │
│         └───────────────┘   点击开门      │
│                                         │
│   本次重量: --.- kg                       │
│   预计金额: ¥--.--                        │
│                                         │
│   今日回收: 125.6 kg                      │
│   累计减碳: 2,340 kg CO₂                  │
│                                         │
├─────────────────────────────────────────┤
│   运营方: XXX环保科技    服务热线: 400-XXX │
└─────────────────────────────────────────┘
```

#### 4.2.5 通信模块 (HW-005)

**功能描述：** 实现设备与云端的数据通信。

**技术指标：**
| 参数 | 指标值 |
|-----|-------|
| 主通信 | 4G LTE Cat.4 |
| 备份通信 | WiFi 2.4G/5G |
| 协议支持 | MQTT 3.1.1/5.0, HTTP/HTTPS |
| 心跳间隔 | 30秒 |
| 断线重连 | 自动重连，支持离线数据缓存 |
| 数据加密 | TLS 1.3 |

**数据上报策略：**
| 数据类型 | 上报频率 | 上报方式 |
|---------|---------|---------|
| 心跳数据 | 30秒/次 | MQTT |
| 投递数据 | 实时 | MQTT + HTTP确认 |
| 报警数据 | 实时 | MQTT + 短信 |
| 监控视频 | 事件触发 | RTMP/HTTP |
| 统计数据 | 每小时 | HTTP |

#### 4.2.6 满载检测 (HW-006)

**功能描述：** 检测箱体内衣物容量状态。

**技术方案：**
- 红外测距传感器：检测箱内衣物高度
- 压力传感器：检测箱底总重量
- 综合判断满载状态

**满载等级：**
| 等级 | 容量占比 | 系统行为 |
|-----|---------|---------|
| 空闲 | 0-30% | 正常投递 |
| 正常 | 30-70% | 正常投递 |
| 较满 | 70-90% | 提示即将满载，通知清运 |
| 满载 | >90% | 停止投递，紧急调度清运 |

#### 4.2.7 门禁控制 (HW-007)

**功能描述：** 控制投递口开关，检测门状态。

**技术指标：**
| 参数 | 指标值 |
|-----|-------|
| 锁具类型 | 电磁锁 |
| 开门方式 | 扫码/按钮触发 |
| 开门超时 | 30秒自动关闭 |
| 门磁检测 | 支持，检测异常开门 |
| 防夹保护 | 红外检测，避免夹伤 |

---

## 5. 软件功能需求

### 5.1 客户端小程序

#### 5.1.1 功能模块总览

```
┌─────────────────────────────────────────────────────────────┐
│                     客户端小程序功能架构                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │   首页模块   │  │   领取模块   │  │      我的模块       │  │
│  ├─────────────┤  ├─────────────┤  ├─────────────────────┤  │
│  │• 附近回收箱  │  │• 扫码领取    │  │• 个人信息           │  │
│  │• 回收指南    │  │• 订单详情    │  │• 投递记录           │  │
│  │• 环保资讯    │  │• 金额确认    │  │• 钱包/提现          │  │
│  │• 积分商城    │  │• 衣物验证    │  │• 碳积分             │  │
│  │             │  │• 领取评价    │  │• 公益证书           │  │
│  │             │  │             │  │• 衣物追踪           │  │
│  │             │  │             │  │• 设置               │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 5.1.2 用户注册与登录 (APP-001)

| 功能点 | 描述 | 优先级 |
|-------|-----|-------|
| 手机号登录 | 手机号 + 验证码快捷登录 | P0 |
| 微信授权登录 | 微信一键授权登录 | P0 |
| 支付宝授权登录 | 支付宝授权登录 | P1 |
| 实名认证 | 身份证实名认证（提现必需） | P0 |
| 隐私协议 | 用户协议与隐私政策确认 | P0 |

#### 5.1.3 附近回收箱 (APP-002)

**功能描述：** 基于用户位置显示附近的智能回收箱。

| 功能点 | 描述 | 优先级 |
|-------|-----|-------|
| 地图展示 | 在地图上显示附近回收箱位置 | P0 |
| 列表展示 | 按距离排序的列表视图 | P0 |
| 状态显示 | 显示回收箱状态（正常/满载/维护中） | P0 |
| 导航功能 | 一键导航至回收箱位置 | P1 |
| 搜索功能 | 按地址/小区名搜索 | P1 |

**回收箱信息卡片：**
```
┌────────────────────────────────────┐
│ 📍 阳光花园A区 回收箱              │
│                                    │
│ 状态: 🟢 正常运行                  │
│ 距离: 320米                        │
│ 今日已回收: 45.6kg                 │
│ 单价: ¥0.30/kg                     │
│                                    │
│ [导航前往]        [扫码领取]       │
└────────────────────────────────────┘
```

> **提示：** 用户可直接前往回收箱，按设备上的按钮开门投递，投递完成后扫码领取金额。

#### 5.1.4 扫码领取 (APP-003)

**功能描述：** 用户在设备端完成投递后，扫描设备屏幕上的二维码领取回收金额。

> **说明：** 本系统采用"先投后扫"模式，用户可直接在设备上按按钮开门投递，无需提前扫码。投递完成后设备自动称重并生成二维码，用户扫码即可领取金额。

**领取流程：**

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
│  扫码    │ ──→ │  查看    │ ──→ │  确认    │ ──→ │  入账    │ ──→ │  完成    │
│         │     │         │     │         │     │         │     │         │
│ 扫描设备 │     │ 查看投递 │     │ 确认领取 │     │ 金额入账 │     │ 领取成功 │
│ 屏幕二维码│     │ 详情信息 │     │ 金额     │     │ 用户钱包 │     │ 页面展示 │
└─────────┘     └─────────┘     └─────────┘     └─────────┘     └─────────┘
```

**详细流程说明：**

| 步骤 | 用户操作 | 系统响应 |
|-----|---------|---------|
| 1. 扫码 | 打开小程序，扫描设备屏幕上的二维码 | 解析订单ID，查询订单信息 |
| 2. 查看 | 查看投递详情（重量/金额/碳减排） | 展示订单详情页面 |
| 3. 登录 | （新用户）完成登录/注册 | 验证用户身份 |
| 4. 确认 | 点击"确认领取"按钮 | 验证订单状态，绑定用户 |
| 5. 入账 | 等待处理完成 | 金额入账用户钱包，积分入账 |
| 6. 完成 | 查看领取成功页面 | 显示余额、积分、公益证书入口 |

**订单状态说明：**

| 订单状态 | 说明 | 用户操作 |
|---------|------|---------|
| 待领取 | 投递完成，等待用户扫码 | 可扫码领取 |
| 已领取 | 用户已领取金额 | 查看详情 |
| 已过期 | 超过有效期未领取 | 联系客服找回 |
| 异常 | 订单存在问题 | 联系客服处理 |

**二维码有效期规则：**
- 屏幕显示有效期：10分钟（倒计时显示）
- 订单保留期：30天（过期后进入"待认领"池，可通过客服找回）

#### 5.1.5 AI衣物验证 (APP-004)

**功能描述：** 通过AI识别验证用户投递物品是否为合规衣物。

| 功能点 | 描述 | 优先级 |
|-------|-----|-------|
| 照片上传 | 用户拍摄/上传衣物照片 | P1 |
| AI识别 | 识别物品类型（衣物/非衣物） | P1 |
| 质量评估 | 评估衣物新旧程度 | P2 |
| 品类识别 | 识别衣物品类（上衣/裤子/鞋子等） | P2 |
| 违规提示 | 识别到非衣物时提示用户 | P1 |

**合规衣物定义：**
- ✅ 可回收：衣服、裤子、裙子、鞋子、包包、床上用品、毛巾等纺织品
- ❌ 不可回收：湿衣物、严重污损衣物、内衣内裤、一次性用品、非纺织品

#### 5.1.6 钱包与提现 (APP-005)

**功能描述：** 管理用户回收收益，支持提现到微信/支付宝。

| 功能点 | 描述 | 优先级 |
|-------|-----|-------|
| 余额查询 | 显示可提现余额 | P0 |
| 提现申请 | 提现至微信/支付宝 | P0 |
| 提现记录 | 查看历史提现记录 | P0 |
| 收益明细 | 每笔投递收益详情 | P0 |
| 公益捐赠 | 将收益捐赠给公益项目 | P1 |

**提现规则：**
| 规则项 | 规则值 |
|-------|-------|
| 最低提现金额 | ¥1.00 |
| 单日提现上限 | ¥500.00 |
| 提现手续费 | 免手续费 |
| 到账时间 | T+1 工作日 |
| 实名要求 | 需完成实名认证 |

#### 5.1.7 碳积分系统 (APP-006)

**功能描述：** 量化用户环保贡献，提供积分激励。

**碳减排计算公式：**
```
碳减排量(kg CO₂) = 衣物重量(kg) × 碳减排系数(2.5 kg CO₂/kg)
碳积分 = 碳减排量 × 10
```

| 功能点 | 描述 | 优先级 |
|-------|-----|-------|
| 积分查询 | 显示累计碳积分 | P1 |
| 积分明细 | 每笔投递获得的积分 | P1 |
| 积分兑换 | 兑换商品/优惠券 | P2 |
| 排行榜 | 环保贡献排行榜 | P2 |
| 成就系统 | 环保成就勋章 | P2 |

#### 5.1.8 投递记录与追踪 (APP-007)

**功能描述：** 查看历史投递记录，追踪衣物去向。

| 功能点 | 描述 | 优先级 |
|-------|-----|-------|
| 记录列表 | 历史投递记录列表 | P0 |
| 记录详情 | 单次投递详细信息 | P0 |
| 衣物追踪 | 追踪衣物处理状态 | P1 |
| 公益证书 | 生成电子公益证书 | P1 |
| 数据统计 | 个人投递数据统计 | P1 |

**衣物追踪状态流：**
```
已投递 → 已清运 → 分拣中 → 已处理 → 去向展示
                              │
                    ┌─────────┼─────────┐
                    ▼         ▼         ▼
                 二次销售   环保再生   公益捐赠
```

### 5.2 后台管理系统

#### 5.2.1 功能模块总览

```
┌───────────────────────────────────────────────────────────────────┐
│                       后台管理系统功能架构                          │
├───────────────────────────────────────────────────────────────────┤
│                                                                    │
│  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌─────────────────┐   │
│  │  工作台    │ │  设备管理  │ │  订单管理  │ │     用户管理     │   │
│  ├───────────┤ ├───────────┤ ├───────────┤ ├─────────────────┤   │
│  │• 数据概览  │ │• 设备列表  │ │• 投递订单  │ │• 用户列表        │   │
│  │• 实时监控  │ │• 设备监控  │ │• 提现订单  │ │• 实名审核        │   │
│  │• 告警中心  │ │• 远程控制  │ │• 清运工单  │ │• 用户反馈        │   │
│  │• 待办事项  │ │• 固件升级  │ │• 异常订单  │ │• 黑名单管理      │   │
│  └───────────┘ └───────────┘ └───────────┘ └─────────────────┘   │
│                                                                    │
│  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌─────────────────┐   │
│  │  财务管理  │ │  运营管理  │ │  统计报表  │ │     系统管理     │   │
│  ├───────────┤ ├───────────┤ ├───────────┤ ├─────────────────┤   │
│  │• 收益统计  │ │• 价格配置  │ │• 回收报表  │ │• 账号管理        │   │
│  │• 提现审核  │ │• 活动管理  │ │• 用户报表  │ │• 角色权限        │   │
│  │• 对账管理  │ │• 内容管理  │ │• 设备报表  │ │• 操作日志        │   │
│  │• 发票管理  │ │• 消息推送  │ │• 财务报表  │ │• 系统配置        │   │
│  └───────────┘ └───────────┘ └───────────┘ └─────────────────┘   │
│                                                                    │
└───────────────────────────────────────────────────────────────────┘
```

#### 5.2.2 工作台 (ADMIN-001)

**功能描述：** 运营人员登录后的首页，展示关键指标和待办事项。

**数据概览面板：**
```
┌─────────────────────────────────────────────────────────────────┐
│  📊 今日数据                                    2026-01-02       │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐ │
│  │   1,256    │  │  3,580.5   │  │  ¥1,074.15 │  │    892     │ │
│  │  投递次数   │  │  回收重量   │  │   发放金额  │  │  活跃用户  │ │
│  │  ↑12.3%    │  │   kg ↑8.5% │  │   ↑8.5%    │  │  ↑15.2%   │ │
│  └────────────┘  └────────────┘  └────────────┘  └────────────┘ │
│                                                                  │
│  ┌────────────────────────────┐  ┌───────────────────────────┐  │
│  │ 📈 近7日投递趋势             │  │ 🚨 告警信息 (3条)          │  │
│  │                            │  │                           │  │
│  │   [折线图]                 │  │ • 设备A001 烟雾报警 09:32  │  │
│  │                            │  │ • 设备B023 满载 10:15      │  │
│  │                            │  │ • 设备C015 离线 11:20      │  │
│  └────────────────────────────┘  └───────────────────────────┘  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 5.2.3 设备管理 (ADMIN-002)

| 功能点 | 描述 | 优先级 |
|-------|-----|-------|
| 设备列表 | 查看所有设备信息，支持筛选排序 | P0 |
| 设备详情 | 查看设备详细信息和运行状态 | P0 |
| 设备监控 | 实时视频监控、传感器数据 | P0 |
| 远程控制 | 远程开门/锁定/重启 | P0 |
| 设备配置 | 配置设备参数（价格/阈值等） | P0 |
| 固件升级 | OTA远程固件升级 | P1 |
| 维护记录 | 设备维护历史记录 | P1 |
| 地图总览 | 在地图上查看所有设备分布 | P1 |

**设备状态监控项：**
| 监控项 | 正常范围 | 预警条件 | 报警条件 |
|-------|---------|---------|---------|
| 在线状态 | 在线 | 心跳超时30s | 心跳超时60s |
| 满载程度 | 0-70% | 70-90% | >90% |
| 箱内温度 | -10~40°C | 40-50°C | >50°C |
| 烟雾浓度 | <0.1 dB/m | 0.1-0.15 dB/m | >0.15 dB/m |
| 门状态 | 正常关闭 | 开门超时30s | 异常开启 |
| 电量(备用) | >30% | 10-30% | <10% |

#### 5.2.4 订单管理 (ADMIN-003)

**投递订单：**
| 功能点 | 描述 | 优先级 |
|-------|-----|-------|
| 订单列表 | 查看所有投递订单 | P0 |
| 订单详情 | 订单详细信息（用户/设备/重量/金额等） | P0 |
| 订单审核 | 人工审核可疑订单 | P0 |
| 订单退款 | 处理异常订单退款 | P1 |
| 订单导出 | 导出订单数据 | P1 |

**清运工单：**
| 功能点 | 描述 | 优先级 |
|-------|-----|-------|
| 工单生成 | 满载自动生成/手动创建清运工单 | P0 |
| 工单分配 | 分配给清运人员 | P0 |
| 工单跟踪 | 跟踪清运进度 | P0 |
| 工单确认 | 清运完成确认 | P0 |

#### 5.2.5 用户管理 (ADMIN-004)

| 功能点 | 描述 | 优先级 |
|-------|-----|-------|
| 用户列表 | 查看所有注册用户 | P0 |
| 用户详情 | 用户详细信息和投递记录 | P0 |
| 实名审核 | 审核用户实名认证 | P0 |
| 用户反馈 | 处理用户反馈和投诉 | P1 |
| 黑名单 | 管理违规用户黑名单 | P1 |
| 消息推送 | 向用户发送通知消息 | P1 |

#### 5.2.6 财务管理 (ADMIN-005)

| 功能点 | 描述 | 优先级 |
|-------|-----|-------|
| 收益统计 | 平台收益统计分析 | P0 |
| 提现审核 | 审核用户提现申请 | P0 |
| 提现记录 | 查看提现历史记录 | P0 |
| 对账管理 | 与支付渠道对账 | P1 |
| 发票管理 | 管理发票开具 | P2 |

#### 5.2.7 统计报表 (ADMIN-006)

**报表类型：**
| 报表名称 | 统计维度 | 主要指标 |
|---------|---------|---------|
| 回收日报 | 按天 | 投递次数、回收重量、发放金额 |
| 设备报表 | 按设备 | 单设备投递量、使用率、异常率 |
| 区域报表 | 按区域 | 区域投递分布、增长趋势 |
| 用户报表 | 按用户 | 新增用户、活跃用户、留存率 |
| 财务报表 | 按月 | 收入、支出、利润分析 |

#### 5.2.8 系统管理 (ADMIN-007)

| 功能点 | 描述 | 优先级 |
|-------|-----|-------|
| 账号管理 | 管理后台账号 | P0 |
| 角色权限 | 配置角色和权限 | P0 |
| 操作日志 | 查看系统操作日志 | P0 |
| 系统配置 | 基础参数配置 | P0 |
| 价格配置 | 配置回收单价 | P0 |

---

## 6. 接口设计

### 6.1 接口概述

系统接口分为三类：
1. **硬件接口**：回收箱设备与云平台通信
2. **小程序接口**：客户端小程序与后端服务通信
3. **后台接口**：管理后台与后端服务通信

### 6.2 硬件接口设计 (MQTT)

#### 6.2.1 Topic规范

```
# 设备上行 (设备 → 云端)
device/{device_id}/heartbeat       # 心跳上报 (包含设备状态+投递记录)
device/{device_id}/alarm           # 报警事件上报 (紧急，立即上报)

# 设备下行 (云端 → 设备)
device/{device_id}/command         # 控制指令
device/{device_id}/config          # 配置下发
device/{device_id}/ota             # 固件升级
```

#### 6.2.2 数据格式定义

**心跳数据（含投递记录上报）：**

> **设计说明：** 设备通过心跳机制定期上报基本状态信息，同时携带自上次心跳以来的投递记录。这种设计简化了通信协议，减少了连接开销，同时保证投递数据最终一致性。

```json
{
  "msg_type": "heartbeat",
  "device_id": "DEV001",
  "timestamp": 1704182400,
  "seq": 12345,                           // 心跳序号，递增
  "data": {
    // ===== 设备基本状态 =====
    "online": true,
    "signal_strength": -65,               // 信号强度 (dBm)
    "temperature": 25.5,                  // 箱内温度 (°C)
    "humidity": 45,                       // 湿度 (%)
    "smoke_level": 0.05,                  // 烟雾浓度 (dB/m)
    "door_status": "closed",              // 门状态: closed/open
    "capacity_percent": 35,               // 容量占比 (%)
    "battery_level": 100,                 // 备用电池电量 (%)
    "current_weight": 12.5,               // 当前箱内总重量 (kg)
    "firmware_version": "1.2.3",          // 固件版本
    "daily_delivery_count": 15,           // 今日投递次数
    "daily_delivery_weight": 28.5,        // 今日投递总重量 (kg)
    
    // ===== 投递记录列表（自上次心跳以来的新投递）=====
    "deliveries": [
      {
        "voucher_id": "V20260102DEV001015",   // 投递凭证ID
        "weight": 3500,                       // 重量 (克)
        "unit_price": 30,                     // 单价 (分/kg)
        "amount": 105,                        // 金额 (分)
        "door_open_time": 1704182380,         // 开门时间戳
        "door_close_time": 1704182395,        // 关门时间戳
        "qrcode_time": 1704182396,            // 二维码生成时间戳
        "signature": "a1b2c3d4e5f6..."        // 数据签名
      },
      {
        "voucher_id": "V20260102DEV001016",
        "weight": 2100,
        "unit_price": 30,
        "amount": 63,
        "door_open_time": 1704182500,
        "door_close_time": 1704182520,
        "qrcode_time": 1704182521,
        "signature": "b2c3d4e5f6g7..."
      }
    ]
  }
}
```

**心跳机制说明：**

| 参数 | 说明 |
|-----|------|
| 心跳间隔 | 正常状态 30秒/次 |
| 投递后心跳 | 投递完成后立即触发一次心跳（携带新投递记录） |
| 离线缓存 | 网络断开时，投递记录本地缓存，恢复后随心跳批量上报 |
| 确认机制 | 后台收到心跳后返回ACK，设备收到ACK后清除已上报的投递记录 |
| 重试机制 | 未收到ACK的投递记录，在下次心跳中继续携带 |

**心跳响应（后台 → 设备）：**
```json
{
  "msg_type": "heartbeat_ack",
  "device_id": "DEV001",
  "timestamp": 1704182401,
  "data": {
    "received_vouchers": ["V20260102DEV001015", "V20260102DEV001016"],  // 确认收到的投递凭证
    "config_version": 5,                    // 当前配置版本，用于判断是否需要同步配置
    "server_time": 1704182401               // 服务器时间，用于校准设备时钟
  }
}
```

**投递记录上报流程：**
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        投递记录心跳上报流程                                   │
└─────────────────────────────────────────────────────────────────────────────┘

设备                                                            后台
 │                                                               │
 │  1. 用户投递完成，本地生成投递记录                               │
 │  ────────────────────────────────────────────────────────────► │
 │     (记录暂存本地缓存)                                          │
 │                                                               │
 │  2. 心跳时间到 / 投递完成触发                                    │
 │  ────────────────────────────────────────────────────────────► │
 │     heartbeat (携带 deliveries 列表)                           │
 │                                                               │
 │                                                               │
 │  3. 返回 heartbeat_ack                                         │
 │  ◄──────────────────────────────────────────────────────────── │
 │     (携带 received_vouchers 确认列表)                           │
 │                                                               │
 │  4. 设备清除已确认的投递记录                                     │
 │                                                               │
 │  ═══════════════════════════════════════════════════════════════
 │                     【网络异常情况】
 │  ═══════════════════════════════════════════════════════════════
 │                                                               │
 │  5. 网络断开，投递记录继续本地缓存                                │
 │                                                               │
 │  6. 网络恢复，下次心跳携带所有未确认的投递记录                     │
 │  ────────────────────────────────────────────────────────────► │
 │                                                               │
```

#### 6.2.3 硬件本地生成二维码规范

> **核心设计：** 硬件主板在本地完成所有计算，生成包含投递信息和数字签名的二维码，无需与后台实时交互。

**二维码内容格式（JSON字符串，Base64编码后生成二维码）：**

```json
{
  "v": 1,                              // 协议版本号
  "d": "DEV001",                       // 设备ID
  "n": "阳光花园A区",                   // 设备名称(可选，用于离线显示)
  "vid": "V20260102DEV001001",         // 投递凭证ID (设备本地生成，唯一)
  "w": 3500,                           // 重量 (单位: 克，整数避免浮点误差)
  "p": 30,                             // 单价 (单位: 分/kg)
  "a": 105,                            // 金额 (单位: 分)
  "t": 1704182396,                     // 生成时间戳 (秒)
  "e": 1704182996,                     // 过期时间戳 (秒，默认10分钟后)
  "s": "HMAC-SHA256签名"               // 数据签名
}
```

**投递凭证ID生成规则：**
```
V + YYYYMMDD + 设备ID + 当日序号(3位)
示例: V20260102DEV001001, V20260102DEV001002
```

**签名机制：**

| 项目 | 说明 |
|-----|------|
| 签名算法 | HMAC-SHA256 |
| 签名密钥 | 每台设备出厂时烧录唯一密钥，后台同步存储 |
| 签名内容 | `{v}.{d}.{vid}.{w}.{p}.{a}.{t}.{e}` |
| 签名目的 | 防止二维码数据被篡改，确保金额真实性 |

**签名生成示例（伪代码）：**
```python
import hmac
import hashlib

def generate_signature(data, device_secret):
    # 拼接待签名字符串
    sign_str = f"{data['v']}.{data['d']}.{data['vid']}.{data['w']}.{data['p']}.{data['a']}.{data['t']}.{data['e']}"
    # 计算HMAC-SHA256
    signature = hmac.new(
        device_secret.encode(), 
        sign_str.encode(), 
        hashlib.sha256
    ).hexdigest()
    return signature
```

**硬件主板本地存储配置：**

| 配置项 | 说明 | 更新方式 |
|-------|------|---------|
| device_id | 设备唯一标识 | 出厂烧录 |
| device_name | 设备名称/位置 | 后台下发 |
| device_secret | 签名密钥 | 出厂烧录，安全存储 |
| unit_price | 回收单价(分/kg) | 后台下发，定期同步 |
| min_weight | 最小有效重量(克) | 后台下发，默认100g |
| qrcode_expire | 二维码有效期(秒) | 后台下发，默认600秒 |
| daily_sequence | 当日投递序号 | 本地维护，每日重置 |

**配置同步机制：**
```json
// 后台 → 设备：配置下发
{
  "msg_type": "config_update",
  "device_id": "DEV001",
  "timestamp": 1704182400,
  "config": {
    "unit_price": 30,
    "min_weight": 100,
    "qrcode_expire": 600,
    "device_name": "阳光花园A区"
  }
}
```

**报警事件：**
```json
{
  "msg_type": "alarm_event",
  "device_id": "DEV001",
  "timestamp": 1704182400,
  "alarm_id": "ALM20260102001",
  "data": {
    "alarm_type": "smoke",
    "alarm_level": 2,
    "smoke_level": 0.35,
    "description": "检测到烟雾浓度超标"
  }
}
```

**控制指令：**
```json
{
  "msg_type": "command",
  "command_id": "CMD20260102001",
  "timestamp": 1704182400,
  "command": "open_door",
  "params": {
    "user_id": "USER123",
    "timeout": 30
  }
}
```

### 6.3 小程序接口设计 (RESTful)

#### 6.3.1 接口规范

**基础URL：** `https://api.xxx.com/v1`

**请求头：**
```
Authorization: Bearer {access_token}
Content-Type: application/json
X-Platform: miniprogram
X-Version: 1.0.0
```

**响应格式：**
```json
{
  "code": 0,
  "message": "success",
  "data": {},
  "timestamp": 1704182400
}
```

#### 6.3.2 接口列表

| 模块 | 接口 | 方法 | 描述 |
|-----|-----|-----|------|
| 用户 | /user/login | POST | 用户登录 |
| 用户 | /user/profile | GET | 获取用户信息 |
| 用户 | /user/bindphone | POST | 绑定手机号 |
| 用户 | /user/bindbank | POST | 绑定提现账户 |
| 设备 | /device/nearby | GET | 获取附近回收箱 |
| 设备 | /device/{id}/info | GET | 获取设备详情 |
| 订单 | /order/scan | POST | 扫码查询订单（扫描设备二维码） |
| 订单 | /order/{id}/detail | GET | 获取订单详情 |
| 订单 | /order/{id}/claim | POST | 领取订单金额 |
| 订单 | /order/list | GET | 获取投递记录 |
| 订单 | /order/{id}/track | GET | 追踪衣物去向 |
| 钱包 | /wallet/balance | GET | 获取余额 |
| 钱包 | /wallet/withdraw | POST | 申请提现 |
| 钱包 | /wallet/records | GET | 交易记录 |
| 积分 | /points/balance | GET | 获取积分 |
| 积分 | /points/records | GET | 积分记录 |

#### 6.3.3 核心接口详情

**扫码解析投递凭证：**
> 用户扫描设备屏幕上的二维码后，后台解析硬件生成的投递凭证数据，验证签名，创建或查询订单

```
POST /order/scan

Request:
{
  "qrcode_data": "eyJ2IjoxLCJkIjoiREVWMDAxIi4uLn0="   // Base64编码的二维码内容
}

Response:
{
  "code": 0,
  "message": "success",
  "data": {
    "order_id": "ORD20260102001",           // 后台生成的订单ID
    "voucher_id": "V20260102DEV001001",     // 硬件生成的投递凭证ID
    "device_id": "DEV001",
    "device_name": "阳光花园A区回收箱",
    "weight": 3.5,                           // kg
    "unit_price": 0.3,                       // 元/kg
    "amount": 1.05,                          // 元
    "carbon_reduction": 8.75,                // kg CO₂
    "points": 88,
    "status": "pending_claim",               // pending_claim-待领取, claimed-已领取, expired-已过期
    "delivery_time": "2026-01-02 10:30:00",
    "qrcode_expire_time": "2026-01-02 10:40:00",
    "is_new_order": true                     // true-首次扫码创建订单, false-已存在订单
  }
}
```

**后台处理逻辑：**
```
1. Base64解码二维码内容
2. 解析JSON数据，提取投递凭证信息
3. 根据device_id查询设备密钥
4. 验证HMAC-SHA256签名
   ├── 签名无效 → 返回错误 10001
   └── 签名有效 → 继续
5. 检查二维码是否过期 (当前时间 > expire_time)
   ├── 已过期 → 返回错误 10004
   └── 未过期 → 继续
6. 根据voucher_id查询是否已创建订单
   ├── 已存在 → 返回已有订单信息
   └── 不存在 → 创建新订单，返回订单信息
```

**领取订单金额：**
> 用户确认订单信息后，领取金额到个人钱包

```
POST /order/{order_id}/claim

Request:
{
  "order_id": "ORD20260102001"
}

Response:
{
  "code": 0,
  "message": "success",
  "data": {
    "order_id": "ORD20260102001",
    "voucher_id": "V20260102DEV001001",
    "weight": 3.5,
    "unit_price": 0.3,
    "amount": 1.05,
    "carbon_reduction": 8.75,
    "points_earned": 88,
    "wallet_balance": 15.60,     // 领取后钱包余额
    "total_points": 1280,        // 累计积分
    "claim_time": "2026-01-02 10:32:00"
  }
}
```

**错误码说明：**
| 错误码 | 说明 |
|-------|------|
| 10001 | 二维码数据无效或签名验证失败 |
| 10002 | 设备不存在或未注册 |
| 10003 | 订单已被领取 |
| 10004 | 二维码已过期，请重新投递或联系客服 |
| 10005 | 用户未完成实名认证（提现时需要） |
| 10006 | 投递凭证数据格式错误 |
| 10007 | 设备密钥不匹配，疑似伪造 |

**申请提现：**
```
POST /wallet/withdraw

Request:
{
  "amount": 10.00,
  "channel": "wechat",
  "openid": "oXXXXXX"
}

Response:
{
  "code": 0,
  "message": "success",
  "data": {
    "withdraw_id": "WD20260102001",
    "amount": 10.00,
    "channel": "wechat",
    "status": "processing",
    "estimated_time": "T+1工作日"
  }
}
```

---

## 7. 数据库设计

### 7.1 数据库选型

| 数据类型 | 存储方案 | 说明 |
|---------|---------|------|
| 业务数据 | MySQL 8.0 | 用户、订单、设备等核心数据 |
| 缓存数据 | Redis 7.0 | 会话、热点数据、计数器 |
| 日志数据 | MongoDB | 设备日志、操作日志 |
| 文件存储 | 对象存储OSS | 图片、视频文件 |

### 7.2 核心表设计

#### 7.2.1 用户表 (users)

```sql
CREATE TABLE users (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    user_id VARCHAR(32) NOT NULL UNIQUE COMMENT '用户ID',
    phone VARCHAR(20) COMMENT '手机号',
    nickname VARCHAR(50) COMMENT '昵称',
    avatar_url VARCHAR(255) COMMENT '头像',
    openid_wechat VARCHAR(64) COMMENT '微信OpenID',
    openid_alipay VARCHAR(64) COMMENT '支付宝OpenID',
    real_name VARCHAR(50) COMMENT '真实姓名',
    id_card VARCHAR(18) COMMENT '身份证号(加密)',
    is_verified TINYINT DEFAULT 0 COMMENT '是否实名 0-否 1-是',
    status TINYINT DEFAULT 1 COMMENT '状态 0-禁用 1-正常',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_phone (phone),
    INDEX idx_openid_wechat (openid_wechat),
    INDEX idx_openid_alipay (openid_alipay)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

#### 7.2.2 设备表 (devices)

> 说明：device_secret 用于验证硬件生成的二维码签名，确保数据未被篡改。

```sql
CREATE TABLE devices (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    device_id VARCHAR(32) NOT NULL UNIQUE COMMENT '设备ID',
    device_name VARCHAR(100) COMMENT '设备名称',
    device_type VARCHAR(20) DEFAULT 'standard' COMMENT '设备型号',
    device_secret VARCHAR(64) NOT NULL COMMENT '设备密钥(用于签名验证，加密存储)',
    location_name VARCHAR(200) COMMENT '位置名称',
    longitude DECIMAL(10, 7) COMMENT '经度',
    latitude DECIMAL(10, 7) COMMENT '纬度',
    province VARCHAR(50) COMMENT '省',
    city VARCHAR(50) COMMENT '市',
    district VARCHAR(50) COMMENT '区',
    address VARCHAR(255) COMMENT '详细地址',
    unit_price DECIMAL(10, 2) DEFAULT 0.30 COMMENT '回收单价(元/kg)',
    min_weight INT DEFAULT 100 COMMENT '最小有效重量(克)',
    qrcode_expire_seconds INT DEFAULT 600 COMMENT '二维码有效期(秒)',
    status TINYINT DEFAULT 1 COMMENT '状态 0-停用 1-正常 2-维护中',
    online_status TINYINT DEFAULT 0 COMMENT '在线状态 0-离线 1-在线',
    capacity_percent INT DEFAULT 0 COMMENT '容量百分比',
    last_heartbeat DATETIME COMMENT '最后心跳时间',
    firmware_version VARCHAR(20) COMMENT '固件版本',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_location (longitude, latitude),
    INDEX idx_status (status, online_status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='设备表';
```

#### 7.2.3 投递订单表 (delivery_orders)

> 说明：采用"先投后扫"模式，硬件本地生成投递凭证(voucher_id)，用户扫码时后台创建订单并关联用户。

```sql
CREATE TABLE delivery_orders (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    order_id VARCHAR(32) NOT NULL UNIQUE COMMENT '订单ID(后台生成)',
    voucher_id VARCHAR(32) NOT NULL UNIQUE COMMENT '投递凭证ID(硬件生成)',
    user_id VARCHAR(32) COMMENT '用户ID(领取时绑定，扫码前为空)',
    device_id VARCHAR(32) NOT NULL COMMENT '设备ID',
    weight DECIMAL(10, 3) COMMENT '重量(kg)',
    unit_price DECIMAL(10, 2) COMMENT '单价(元/kg)',
    amount DECIMAL(10, 2) COMMENT '金额(元)',
    carbon_reduction DECIMAL(10, 2) COMMENT '碳减排量(kg)',
    points_earned INT DEFAULT 0 COMMENT '获得积分',
    status TINYINT DEFAULT 0 COMMENT '状态 0-待领取 1-已领取 2-已过期 3-异常',
    signature VARCHAR(128) COMMENT '硬件签名(用于验证数据真实性)',
    qrcode_data TEXT COMMENT '二维码原始数据(JSON)',
    qrcode_generate_time DATETIME COMMENT '二维码生成时间(硬件)',
    qrcode_expire_time DATETIME COMMENT '二维码过期时间',
    door_open_time DATETIME COMMENT '开门时间',
    door_close_time DATETIME COMMENT '关门时间',
    scan_time DATETIME COMMENT '首次扫码时间',
    claim_time DATETIME COMMENT '领取时间',
    image_urls TEXT COMMENT '图片URL(JSON)',
    video_url VARCHAR(255) COMMENT '投递视频URL',
    source VARCHAR(20) DEFAULT 'scan' COMMENT '订单来源: scan-扫码创建, async-异步上报创建',
    remark VARCHAR(255) COMMENT '备注',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_voucher_id (voucher_id),
    INDEX idx_user_id (user_id),
    INDEX idx_device_id (device_id),
    INDEX idx_status (status),
    INDEX idx_qrcode_expire (qrcode_expire_time),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='投递订单表';
```

**订单创建方式：**
| 来源 | 说明 |
|-----|------|
| scan | 用户扫码时创建，解析硬件二维码数据后生成订单 |
| async | 设备异步上报投递事件时创建（用于数据补全和统计） |

**订单状态流转：**
```
                                    用户扫码
                                       │
                                       ▼
┌─────────────────┐     ┌─────────┐     ┌─────────┐
│ (硬件生成凭证)   │ ──→ │ 待领取   │ ──→ │ 已领取   │
│  无订单记录      │     │ (0)     │     │ (1)     │
└─────────────────┘     └─────────┘     └─────────┘
                             │                
                             │ (超过30天未领取)
                             ▼                
                        ┌─────────┐
                        │ 已过期   │
                        │ (2)     │
                        └─────────┘
```

**数据一致性说明：**
- `voucher_id` 由硬件生成，全局唯一，用于防止重复领取
- 用户扫码时，后台根据 `voucher_id` 判断是否已创建订单
- 设备异步上报的数据与扫码创建的订单通过 `voucher_id` 关联

#### 7.2.4 用户钱包表 (user_wallets)

```sql
CREATE TABLE user_wallets (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    user_id VARCHAR(32) NOT NULL UNIQUE COMMENT '用户ID',
    balance DECIMAL(12, 2) DEFAULT 0.00 COMMENT '可用余额',
    frozen_balance DECIMAL(12, 2) DEFAULT 0.00 COMMENT '冻结余额',
    total_income DECIMAL(12, 2) DEFAULT 0.00 COMMENT '累计收入',
    total_withdraw DECIMAL(12, 2) DEFAULT 0.00 COMMENT '累计提现',
    version INT DEFAULT 0 COMMENT '乐观锁版本号',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户钱包表';
```

#### 7.2.5 提现记录表 (withdraw_records)

```sql
CREATE TABLE withdraw_records (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    withdraw_id VARCHAR(32) NOT NULL UNIQUE COMMENT '提现ID',
    user_id VARCHAR(32) NOT NULL COMMENT '用户ID',
    amount DECIMAL(10, 2) NOT NULL COMMENT '提现金额',
    channel VARCHAR(20) NOT NULL COMMENT '提现渠道 wechat/alipay',
    account_info VARCHAR(255) COMMENT '账户信息(加密)',
    status TINYINT DEFAULT 0 COMMENT '状态 0-处理中 1-成功 2-失败',
    fail_reason VARCHAR(255) COMMENT '失败原因',
    transfer_time DATETIME COMMENT '到账时间',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='提现记录表';
```

#### 7.2.6 设备报警表 (device_alarms)

```sql
CREATE TABLE device_alarms (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    alarm_id VARCHAR(32) NOT NULL UNIQUE COMMENT '报警ID',
    device_id VARCHAR(32) NOT NULL COMMENT '设备ID',
    alarm_type VARCHAR(20) NOT NULL COMMENT '报警类型 smoke/door/offline/full',
    alarm_level TINYINT DEFAULT 1 COMMENT '报警等级 1-预警 2-报警 3-紧急',
    alarm_data TEXT COMMENT '报警数据(JSON)',
    status TINYINT DEFAULT 0 COMMENT '状态 0-未处理 1-处理中 2-已处理',
    handler_id VARCHAR(32) COMMENT '处理人ID',
    handle_time DATETIME COMMENT '处理时间',
    handle_remark VARCHAR(255) COMMENT '处理备注',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_device_id (device_id),
    INDEX idx_alarm_type (alarm_type),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='设备报警表';
```

### 7.3 ER关系图

```
┌─────────────┐       ┌─────────────────┐       ┌─────────────┐
│   users     │       │ delivery_orders │       │   devices   │
├─────────────┤       ├─────────────────┤       ├─────────────┤
│ user_id PK  │◄──────│ user_id FK      │       │ device_id PK│
│ phone       │       │ device_id FK    │──────►│ device_name │
│ nickname    │       │ order_id PK     │       │ location    │
│ ...         │       │ weight          │       │ unit_price  │
└─────────────┘       │ amount          │       │ ...         │
      │               │ ...             │       └─────────────┘
      │               └─────────────────┘              │
      │                                                │
      ▼                                                ▼
┌─────────────┐                               ┌─────────────────┐
│user_wallets │                               │ device_alarms   │
├─────────────┤                               ├─────────────────┤
│ user_id FK  │                               │ device_id FK    │
│ balance     │                               │ alarm_id PK     │
│ ...         │                               │ alarm_type      │
└─────────────┘                               │ ...             │
      │                                       └─────────────────┘
      ▼
┌─────────────────┐
│withdraw_records │
├─────────────────┤
│ user_id FK      │
│ withdraw_id PK  │
│ amount          │
│ ...             │
└─────────────────┘
```

---

## 8. 业务流程设计

### 8.1 用户投递流程

> **流程特点：** 用户无需提前扫码，可直接手动开门投递衣物。投递完成后，**硬件主板自主完成称重和金额计算**，无需与后台实时交互，直接在本地生成包含投递信息的二维码。用户扫码后，小程序与后台交互完成订单创建和金额领取。

```
┌──────────────────────────────────────────────────────────────────────────┐
│               用户投递流程（先投后扫模式 - 硬件离线计算）                    │
└──────────────────────────────────────────────────────────────────────────┘

┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────────┐     ┌─────────┐
│ 手动开门 │ ──→ │  投递    │ ──→ │  关门    │ ──→ │ 硬件本地计算 │ ──→ │ 扫码领取 │
│         │     │         │     │         │     │             │     │         │
│ 按下开门 │     │ 放入    │     │ 手动关门 │     │ 主板自动称重 │     │ 扫描屏幕 │
│ 按钮     │     │ 衣物    │     │ 或超时   │     │ 计算金额    │     │ 二维码   │
│         │     │         │     │ 自动关闭 │     │ 生成二维码   │     │ 领取金额 │
└─────────┘     └─────────┘     └─────────┘     └─────────────┘     └─────────┘
                                                       │
                                               【无需联网】
                                               【本地完成】
```

**详细时序图：**

```
┌─────────┐              ┌──────────────┐              ┌─────────┐              ┌─────────┐
│  用户    │              │ 设备(硬件主板) │              │ 后端服务 │              │  小程序  │
└────┬────┘              └──────┬───────┘              └────┬────┘              └────┬────┘
     │                          │                           │                        │
     │ ═══════════════════════════════════════════════════════════════════════════════ │
     │                    【第一阶段：投递阶段 - 纯硬件离线操作】                         │
     │ ═══════════════════════════════════════════════════════════════════════════════ │
     │                          │                           │                        │
     │  1. 按下开门按钮          │                           │                        │
     │ ───────────────────────► │                           │                        │
     │                          │                           │                        │
     │  2. 投递口打开            │                           │                        │
     │ ◄─────────────────────── │                           │                        │
     │                          │                           │                        │
     │  3. 放入衣物              │                           │                        │
     │ ───────────────────────► │                           │                        │
     │                          │                           │                        │
     │  4. 屏幕实时显示重量      │  (硬件本地称重)            │                        │
     │ ◄─────────────────────── │                           │                        │
     │                          │                           │                        │
     │  5. 按下关门按钮/超时      │                           │                        │
     │ ───────────────────────► │                           │                        │
     │                          │                           │                        │
     │  6. 投递口关闭            │                           │                        │
     │ ◄─────────────────────── │                           │                        │
     │                          │                           │                        │
     │                          │  7. 【硬件本地处理】        │                        │
     │                          │     • 读取最终重量          │                        │
     │                          │     • 按本地单价计算金额    │                        │
     │                          │     • 生成投递凭证ID        │                        │
     │                          │     • 对数据进行签名        │                        │
     │                          │     • 生成二维码           │                        │
     │                          │                           │                        │
     │  8. 屏幕显示二维码+信息   │                           │                        │
     │ ◄─────────────────────── │                           │                        │
     │    • 二维码(含签名数据)   │                           │                        │
     │    • 重量: 3.5kg         │                           │                        │
     │    • 金额: ¥1.05         │                           │                        │
     │    • 有效期倒计时         │                           │                        │
     │                          │                           │                        │
     │                          │  9. 【心跳上报】             │                        │
     │                          │     投递记录暂存本地缓存     │                        │
     │                          │     随下次心跳携带上报       │                        │
     │                          │ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─►│                        │
     │                          │     (不影响用户体验)        │                        │
     │                          │                           │                        │
     │ ═══════════════════════════════════════════════════════════════════════════════ │
     │                    【第二阶段：领取阶段 - 需要联网】                              │
     │ ═══════════════════════════════════════════════════════════════════════════════ │
     │                          │                           │                        │
     │ 10. 打开小程序扫码        │                           │                        │
     │ ──────────────────────────────────────────────────────────────────────────────►│
     │                          │                           │                        │
     │                          │                           │ 11. 解析二维码数据     │
     │                          │                           │     验证签名有效性     │
     │                          │                           │     创建/查询订单      │
     │                          │                           │ ◄─────────────────────│
     │                          │                           │                        │
     │                          │                           │ 12. 返回订单详情       │
     │                          │                           │ ────────────────────► │
     │                          │                           │                        │
     │ 13. 显示投递信息          │                           │                        │
     │ ◄─────────────────────────────────────────────────────────────────────────────│
     │    (重量/金额/碳减排)     │                           │                        │
     │                          │                           │                        │
     │ 14. 确认领取金额          │                           │                        │
     │ ──────────────────────────────────────────────────────────────────────────────►│
     │                          │                           │                        │
     │                          │                           │ 15. 绑定用户+入账      │
     │                          │                           │ ◄─────────────────────│
     │                          │                           │                        │
     │                          │                           │ 16. 确认入账成功       │
     │                          │                           │ ────────────────────► │
     │                          │                           │                        │
     │ 17. 显示领取成功          │                           │                        │
     │ ◄─────────────────────────────────────────────────────────────────────────────│
     │                          │                           │                        │
     │                          │  18. (可选)通知设备订单已领取                        │
     │                          │ ◄─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─│                        │
     │                          │                           │                        │
     │ 19. 屏幕恢复待机状态      │                           │                        │
     │ ◄─────────────────────── │                           │                        │
     │                          │                           │                        │
```

**流程说明：**

| 阶段 | 步骤 | 用户操作 | 系统响应 |
|-----|-----|---------|---------|
| **投递阶段**（硬件离线） | 1 | 按下设备上的"开门"按钮 | 设备验证状态正常后打开投递口 |
| | 2 | 将衣物放入投递口 | 屏幕实时显示当前重量（硬件本地读取传感器） |
| | 3 | 按下"关门"按钮或等待30秒超时 | 投递口自动关闭 |
| | 4 | - | **硬件主板本地计算**：读取最终重量、按预设单价计算金额 |
| | 5 | - | **硬件主板本地生成**：生成投递凭证ID、对数据签名、生成二维码 |
| | 6 | 查看屏幕显示的二维码和金额信息 | 屏幕显示：二维码 + 重量 + 金额 + 有效期倒计时 |
| **领取阶段**（需联网） | 7 | 打开小程序扫描屏幕二维码 | 解析二维码数据，验证签名 |
| | 8 | 查看投递详情（重量/金额/碳减排） | 后台创建订单，展示详情，新用户引导注册 |
| | 9 | 点击"确认领取" | 金额入账用户钱包 |
| | 10 | 查看领取成功页面 | 显示余额和碳积分 |

**硬件离线计算的优势：**

| 优势 | 说明 |
|-----|------|
| 无网络依赖 | 投递过程完全离线，不受网络波动影响 |
| 响应速度快 | 称重和金额计算毫秒级完成，无网络延迟 |
| 心跳批量上报 | 投递数据随心跳批量上报，减少通信开销 |
| 高可用性 | 即使后台服务异常，用户仍可完成投递 |
| 用户体验好 | 整个投递过程流畅，无等待 |

**异常处理：**

| 异常场景 | 处理方式 |
|---------|---------|
| 二维码过期未扫 | 屏幕显示有效期10分钟，过期后设备恢复待机；投递记录已随心跳上报后台，用户可联系客服找回 |
| 投递重量过轻 | 重量 < 100g 时，硬件判断为无效投递，提示"投递量过少"，不生成二维码 |
| 设备满载 | 投递前检测容量，满载时禁止开门并提示用户 |
| 网络异常 | 不影响投递流程；投递记录本地缓存，网络恢复后随心跳批量上报后台 |
| 用户未注册 | 扫码后引导注册/登录，完成后自动领取金额 |
| 二维码被篡改 | 后台验证签名失败，拒绝领取并提示用户 |
| 心跳丢失 | 未确认的投递记录在下次心跳中继续携带，直到收到后台ACK确认 |

### 8.2 提现流程

```
┌──────────────────────────────────────────────────────────────────────────┐
│                            提现流程                                       │
└──────────────────────────────────────────────────────────────────────────┘

用户                小程序              后端服务             第三方支付
 │                   │                   │                    │
 │ 1. 申请提现        │                   │                    │
 │──────────────────►│                   │                    │
 │                   │                   │                    │
 │                   │ 2. 提交提现请求    │                    │
 │                   │──────────────────►│                    │
 │                   │                   │                    │
 │                   │                   │ 3. 校验余额/实名    │
 │                   │                   │ ────────────────►  │
 │                   │                   │                    │
 │                   │                   │ 4. 冻结余额        │
 │                   │                   │ ◄──────────────── │
 │                   │                   │                    │
 │                   │ 5. 返回申请结果    │                    │
 │                   │◄──────────────────│                    │
 │                   │                   │                    │
 │ 6. 显示处理中      │                   │                    │
 │◄──────────────────│                   │                    │
 │                   │                   │                    │
 │                   │                   │ 7. (异步)调用转账   │
 │                   │                   │───────────────────►│
 │                   │                   │                    │
 │                   │                   │ 8. 转账结果回调     │
 │                   │                   │◄───────────────────│
 │                   │                   │                    │
 │                   │                   │ 9. 更新提现状态     │
 │                   │                   │ ────────────────►  │
 │                   │                   │                    │
 │                   │ 10. 推送提现结果   │                    │
 │◄──────────────────│◄──────────────────│                    │
 │                   │                   │                    │
```

### 8.3 报警处理流程

```
┌──────────────────────────────────────────────────────────────────────────┐
│                          报警处理流程                                     │
└──────────────────────────────────────────────────────────────────────────┘

设备              IoT平台             后端服务            运维人员
 │                  │                   │                   │
 │ 1. 检测到烟雾     │                   │                   │
 │─────────────────►│                   │                   │
 │                  │                   │                   │
 │                  │ 2. 上报报警事件    │                   │
 │                  │──────────────────►│                   │
 │                  │                   │                   │
 │                  │                   │ 3. 记录报警       │
 │                  │                   │ ────────────────► │
 │                  │                   │                   │
 │                  │                   │ 4. 判断报警等级   │
 │                  │                   │ ◄──────────────── │
 │                  │                   │                   │
 │                  │                   │ 5. 推送报警通知   │
 │                  │                   │──────────────────►│
 │                  │                   │                   │
 │ 6. 下发锁定指令   │                   │                   │
 │◄─────────────────│◄──────────────────│                   │
 │                  │                   │                   │
 │ 7. 锁定投递口     │                   │                   │
 │──────────────────│──────────────────►│                   │
 │                  │                   │                   │
 │                  │                   │ 8. 现场处理       │
 │                  │                   │◄──────────────────│
 │                  │                   │                   │
 │                  │                   │ 9. 更新处理状态   │
 │                  │                   │◄──────────────────│
 │                  │                   │                   │
 │ 10. 解除锁定     │                   │                   │
 │◄─────────────────│◄──────────────────│                   │
 │                  │                   │                   │
```

---

## 9. 安全设计

### 9.1 安全架构

```
┌────────────────────────────────────────────────────────────────────┐
│                          安全防护体系                               │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │                     网络安全层                               │  │
│  │  • HTTPS/TLS加密传输  • WAF防火墙  • DDoS防护  • IP白名单     │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                              │                                     │
│                              ▼                                     │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │                     应用安全层                               │  │
│  │  • JWT身份认证  • RBAC权限控制  • 接口限流  • SQL注入防护     │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                              │                                     │
│                              ▼                                     │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │                     数据安全层                               │  │
│  │  • 敏感数据加密  • 数据脱敏  • 访问审计  • 备份恢复           │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                              │                                     │
│                              ▼                                     │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │                     设备安全层                               │  │
│  │  • 设备认证  • 固件签名  • 安全启动  • 本地数据加密           │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
```

### 9.2 身份认证

| 认证场景 | 认证方式 | Token有效期 |
|---------|---------|------------|
| 用户登录 | 微信/支付宝OAuth + JWT | 7天 |
| 后台登录 | 账号密码 + 图形验证码 + JWT | 8小时 |
| 设备认证 | 设备证书 + 密钥 | 长期有效 |
| API调用 | API Key + 签名 | 按请求验证 |

### 9.3 数据加密

| 数据类型 | 加密方式 | 说明 |
|---------|---------|------|
| 传输数据 | TLS 1.3 | 全链路HTTPS |
| 用户密码 | bcrypt | 不可逆哈希 |
| 身份证号 | AES-256-GCM | 对称加密存储 |
| 银行卡号 | AES-256-GCM | 对称加密存储 |
| 设备通信 | MQTT over TLS | 加密通道 |

### 9.4 隐私保护

| 保护措施 | 描述 |
|---------|------|
| 数据最小化 | 只收集必要的用户数据 |
| 脱敏展示 | 手机号、身份证号显示时脱敏 |
| 授权访问 | 用户数据访问需经用户授权 |
| 日志脱敏 | 日志中敏感信息自动脱敏 |
| 数据删除 | 支持用户申请数据删除 |

---

## 10. 非功能性需求

### 10.1 性能需求

| 指标 | 目标值 | 说明 |
|-----|-------|------|
| 接口响应时间 | P99 < 500ms | 核心接口响应时间 |
| 并发能力 | 1000 QPS | 系统并发处理能力 |
| 设备接入数 | 10000台 | 单集群支持设备数 |
| 消息延迟 | < 1秒 | 设备消息上报延迟 |
| 数据库响应 | < 100ms | 单表查询响应时间 |

### 10.2 可用性需求

| 指标 | 目标值 | 说明 |
|-----|-------|------|
| 系统可用性 | 99.9% | 年度不可用时间<8.76小时 |
| 故障恢复 | < 30分钟 | 单点故障恢复时间 |
| 数据持久性 | 99.99% | 数据不丢失 |
| 灾备能力 | 同城双活 | 主备切换能力 |

### 10.3 扩展性需求

| 需求 | 描述 |
|-----|------|
| 水平扩展 | 支持服务节点水平扩展 |
| 设备扩展 | 支持设备数量线性扩展 |
| 功能扩展 | 模块化设计，支持功能插件化 |
| 多租户 | 支持多运营商接入 |

### 10.4 兼容性需求

| 平台 | 版本要求 |
|-----|---------|
| 微信小程序 | 基础库 2.20.0+ |
| 支付宝小程序 | 基础库 2.0.0+ |
| Android | Android 6.0+ |
| iOS | iOS 11.0+ |
| 浏览器 | Chrome 80+, Firefox 75+, Safari 13+ |

---

## 11. 项目里程碑

### 11.1 项目阶段

| 阶段 | 时间周期 | 主要目标 |
|-----|---------|---------|
| 第一阶段 | 第1-4周 | 需求确认、架构设计、技术选型 |
| 第二阶段 | 第5-12周 | 核心功能开发（硬件+后端+小程序） |
| 第三阶段 | 第13-16周 | 系统联调、测试、优化 |
| 第四阶段 | 第17-18周 | 试点部署、用户测试 |
| 第五阶段 | 第19-20周 | 正式上线、运营支持 |

### 11.2 详细计划

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  周次  │ 1 │ 2 │ 3 │ 4 │ 5 │ 6 │ 7 │ 8 │ 9 │10 │11 │12 │13 │14 │15 │16 │17 │18 │19 │20 │
├────────┼───┴───┴───┴───┼───┴───┴───┴───┴───┴───┴───┴───┼───┴───┴───┴───┼───┴───┼───┴───┤
│需求设计 │ ████████████ │                               │               │       │       │
│硬件开发 │               │ ████████████████████████████ │               │       │       │
│后端开发 │               │ ████████████████████████████ │               │       │       │
│小程序开发│               │     ████████████████████████ │               │       │       │
│后台开发 │               │         ████████████████████ │               │       │       │
│系统联调 │               │                               │ ████████████ │       │       │
│测试优化 │               │                               │ ████████████ │       │       │
│试点部署 │               │                               │               │ ████ │       │
│正式上线 │               │                               │               │       │ ████ │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 11.3 交付物清单

| 阶段 | 交付物 |
|-----|-------|
| 第一阶段 | 需求规格说明书、架构设计文档、数据库设计文档、接口设计文档 |
| 第二阶段 | 硬件原型、后端服务代码、小程序代码、后台系统代码 |
| 第三阶段 | 测试报告、性能测试报告、安全测试报告 |
| 第四阶段 | 部署文档、运维手册、用户手册 |
| 第五阶段 | 上线报告、培训材料 |

---

## 附录

### 附录A：术语表

| 术语 | 说明 |
|-----|------|
| IoT | 物联网 (Internet of Things) |
| MQTT | 消息队列遥测传输协议 |
| OTA | 空中下载技术 (Over-The-Air) |
| QPS | 每秒查询率 (Queries Per Second) |
| JWT | JSON Web Token |
| RBAC | 基于角色的访问控制 |

### 附录B：参考资料

1. 支付宝×鸥燕回收AI智能旧衣回收箱方案
2. 广州琶洲街AI智能旧衣回收箱案例
3. "我来收"智能回收平台功能设计
4. "榕益收"高校智能回收箱方案
5. 国家旧衣物回收行业标准

---

**文档编写：** 系统设计团队  
**审核人员：** _________________  
**批准日期：** _________________

