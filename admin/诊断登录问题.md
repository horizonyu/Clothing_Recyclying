# 登录后"服务器错误"诊断指南

## 排查步骤

### 1. 查看浏览器控制台

打开浏览器开发者工具（F12），查看：
- **Console 标签**：查看 JavaScript 错误
- **Network 标签**：查看 API 请求和响应

重点关注：
- 登录接口：`POST /api/v1/admin/auth/login`
- 获取用户信息：`GET /api/v1/admin/auth/profile`
- 获取统计数据：`GET /api/v1/admin/dashboard/stats`

### 2. 查看后端日志

```bash
# 在服务器上查看 API 容器日志
docker logs clothing-recycle-api --tail 100 -f
```

### 3. 测试 API 接口

```bash
# 测试登录接口
curl -X POST http://localhost:8000/api/v1/admin/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'

# 如果登录成功，会返回 token，然后测试获取用户信息
curl -X GET http://localhost:8000/api/v1/admin/auth/profile \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

## 常见问题

### 问题1：认证失败（401错误）

**原因**：Token 格式错误或已过期

**解决**：检查前端是否正确发送 Authorization header

### 问题2：数据库查询错误（500错误）

**原因**：数据库表不存在或查询失败

**解决**：
```bash
# 检查数据库表是否存在
docker exec -it clothing-recycle-mysql mysql -urecycle -precycle123456 -e "USE clothing_recycle; SHOW TABLES;"

# 检查 admins 表是否存在
docker exec -it clothing-recycle-mysql mysql -urecycle -precycle123456 -e "USE clothing_recycle; DESCRIBE admins;"
```

### 问题3：API 路由未注册

**原因**：管理后台 API 路由未正确注册

**解决**：检查 `backend/app/api/v1/__init__.py` 是否包含 admin 路由
