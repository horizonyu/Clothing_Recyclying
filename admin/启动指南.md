# 管理后台启动指南

## 方式一：本地开发（推荐用于开发测试）

### 1. 安装 Node.js

确保已安装 Node.js 16+ 和 npm：

```bash
# 检查版本
node -v  # 应该 >= 16.0.0
npm -v   # 应该 >= 7.0.0
```

如果没有安装，访问 https://nodejs.org/ 下载安装。

### 2. 安装依赖

```bash
cd admin
npm install
```

### 3. 配置 API 地址

编辑 `vite.config.js`，修改代理目标为你的服务器地址：

```javascript
server: {
  port: 3000,
  proxy: {
    '/api': {
      target: 'http://你的服务器IP:8000',  // 修改这里
      changeOrigin: true
    }
  }
}
```

或者如果使用 Nginx，可以改为：

```javascript
proxy: {
  '/api': {
    target: 'http://你的服务器IP',  // 通过 Nginx 访问（80端口）
    changeOrigin: true
  }
}
```

### 4. 启动开发服务器

```bash
npm run dev
```

访问：http://localhost:3000

### 5. 登录

使用创建的管理员账号登录：
- 用户名: `admin`
- 密码: `admin123`

---

## 方式二：服务器部署（生产环境）

### 1. 在服务器上安装 Node.js

```bash
# Ubuntu/Debian
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 验证安装
node -v
npm -v
```

### 2. 上传代码到服务器

```bash
# 在本地执行（从本地电脑）
scp -r admin root@你的服务器IP:/opt/Clothing_Recycle/

# 或使用 git
ssh root@你的服务器IP
cd /opt/Clothing_Recycle
git pull
```

### 3. 在服务器上安装依赖

```bash
cd /opt/Clothing_Recycle/admin
npm install
```

### 4. 修改配置

编辑 `vite.config.js`：

```javascript
server: {
  host: '0.0.0.0',  // 允许外部访问
  port: 3000,
  proxy: {
    '/api': {
      target: 'http://localhost:8000',  // 服务器本地访问
      changeOrigin: true
    }
  }
}
```

### 5. 启动服务

**开发模式（临时测试）：**

```bash
npm run dev
```

**生产模式（推荐）：**

```bash
# 构建生产版本
npm run build

# 使用 PM2 或其他进程管理器运行
npm install -g pm2
pm2 serve dist 3000 --name admin-frontend
```

### 6. 配置 Nginx 反向代理（可选）

如果需要通过 80 端口访问，可以配置 Nginx：

```nginx
server {
    listen 80;
    server_name admin.yourdomain.com;  # 或使用 IP

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

---

## 方式三：Docker 部署（推荐生产环境）

### 1. 创建 Dockerfile

在 `admin` 目录下创建 `Dockerfile`：

```dockerfile
FROM node:18-alpine as builder

WORKDIR /app

# 复制依赖文件
COPY package*.json ./

# 安装依赖
RUN npm install

# 复制源代码
COPY . .

# 构建
RUN npm run build

# 生产环境
FROM nginx:alpine

# 复制构建结果
COPY --from=builder /app/dist /usr/share/nginx/html

# 复制 Nginx 配置
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

### 2. 创建 Nginx 配置

在 `admin` 目录下创建 `nginx.conf`：

```nginx
server {
    listen 80;
    server_name _;
    root /usr/share/nginx/html;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://你的API服务器IP:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### 3. 构建和运行

```bash
cd admin

# 构建镜像
docker build -t admin-frontend .

# 运行容器
docker run -d \
  --name admin-frontend \
  -p 3000:80 \
  --restart always \
  admin-frontend
```

---

## 快速启动（本地开发）

```bash
# 1. 进入目录
cd admin

# 2. 安装依赖（首次运行）
npm install

# 3. 启动开发服务器
npm run dev

# 4. 浏览器访问
# http://localhost:3000
```

---

## 常见问题

### Q: 无法连接到后端 API

**检查：**
1. 后端服务是否正常运行：`curl http://localhost:8000/health`
2. `vite.config.js` 中的代理配置是否正确
3. 浏览器控制台是否有 CORS 错误

**解决：**
- 如果后端在服务器上，修改 `vite.config.js` 中的 `target` 为服务器地址
- 确保后端 CORS 配置允许前端域名

### Q: 登录后提示 401 错误

**检查：**
1. 管理员账号是否创建成功
2. 后端 API 是否正常：`curl http://localhost:8000/api/v1/admin/auth/login`
3. 浏览器 Network 标签查看请求和响应

### Q: 端口被占用

**解决：**
```bash
# 修改 vite.config.js 中的 port
server: {
  port: 3001,  # 改为其他端口
}
```

---

## 默认登录信息

- **用户名**: `admin`
- **密码**: `admin123`

⚠️ **重要：首次登录后请立即修改密码！**
