<!--pages/nearby/nearby.wxml-->
<!--é™„è¿‘å›æ”¶ç®±é¡µé¢-->

<view class="container">
  <!-- åœ°å›¾è§†å›¾ -->
  <view class="map-container" wx:if="{{!showList}}">
    <map class="map"
         latitude="{{latitude}}"
         longitude="{{longitude}}"
         markers="{{markers}}"
         show-location
         scale="15"
         bindmarkertap="onMarkerTap">
    </map>
    
    <!-- åˆ·æ–°æŒ‰é’® -->
    <view class="map-controls">
      <view class="control-btn" bindtap="refreshLocation">
        <text>ğŸ“</text>
      </view>
      <view class="control-btn" bindtap="toggleView">
        <text>ğŸ“‹</text>
      </view>
    </view>
  </view>

  <!-- åˆ—è¡¨è§†å›¾ -->
  <view class="list-container" wx:if="{{showList}}">
    <!-- é¡¶éƒ¨æ“ä½œæ  -->
    <view class="list-header">
      <view class="header-title">
        <text class="title">é™„è¿‘å›æ”¶ç®±</text>
        <text class="count">å…±{{devices.length}}ä¸ª</text>
      </view>
      <view class="header-actions">
        <view class="action-btn" bindtap="refreshLocation">
          <text>åˆ·æ–°</text>
        </view>
        <view class="action-btn" bindtap="toggleView">
          <text>åœ°å›¾</text>
        </view>
      </view>
    </view>

    <!-- è®¾å¤‡åˆ—è¡¨ -->
    <view class="device-list" wx:if="{{devices.length > 0}}">
      <view class="device-item" 
            wx:for="{{devices}}" 
            wx:key="device_id"
            data-index="{{index}}">
        <view class="device-info" bindtap="onDeviceTap" data-index="{{index}}">
          <view class="device-icon">ğŸ“¦</view>
          <view class="device-detail">
            <text class="device-name">{{item.name}}</text>
            <text class="device-address">{{item.address}}</text>
            <view class="device-tags">
              <text class="tag {{item.status === 'online' ? 'tag-success' : 'tag-danger'}}">
                {{item.status === 'online' ? 'åœ¨çº¿' : 'ç¦»çº¿'}}
              </text>
              <text class="device-distance">{{formatDistance(item.distance)}}</text>
            </view>
          </view>
        </view>
        <view class="device-action" bindtap="navigateTo" data-index="{{index}}">
          <text class="action-icon">ğŸ§­</text>
          <text class="action-text">å¯¼èˆª</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty" wx:if="{{devices.length === 0 && !loading}}">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">é™„è¿‘æš‚æ— å›æ”¶ç®±</text>
      <text class="empty-tip">è¯·å°è¯•æ‰©å¤§æœç´¢èŒƒå›´</text>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading" wx:if="{{loading}}">
      <text class="loading-text">å®šä½ä¸­...</text>
    </view>
  </view>
</view>

